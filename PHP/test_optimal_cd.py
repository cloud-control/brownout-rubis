from nose.tools import assert_almost_equals
import numpy as np

from localController import *

pb=5
pd=10

capacity_scaling_factor=3.03810674805e-05
revenue = Revenue(gamma=2.28e-6/capacity_scaling_factor, k=0.7, beta=1.0)
compute_optimal_cd(pd, revenue, None, [1, 30])

xc = np.array([0  , 1  , 2  , 3  , 4  , 5  , 6  ])
fc = np.array([0.1, 0.1, 0.2, 0.3, 0.2, 0.1, 0.1])
compute_optimal_cd(pd, revenue, fc, xc)

def stringListToNp(a):
    return np.array(map(float, a.split(',')[:-1]))

fc = stringListToNp(
'0.0034247,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0034247,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0034247,0,0,0,0,0,0.0034247,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0034247,0,0,0,0,0,0,0.0034247,0,0,0.0068493,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0034247,0,0,0,0,0,0,0.0034247,0,0.0034247,0,0.0034247,0,0,0,0,0,0,0,0.0034247,0,0,0,0,0,0.010274,0,0,0,0,0,0,0,0,0,0.0034247,0.0034247,0,0,0,0,0,0.0068493,0,0.0034247,0,0,0,0,0,0,0,0,0.0034247,0,0.0034247,0,0,0,0,0.0034247,0,0.0034247,0.0068493,0,0,0.0068493,0,0,0,0,0,0.0034247,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0034247,0.0034247,0,0,0,0,0,0,0.0034247,0.0034247,0,0,0,0,0,0.0034247,0,0,0.0034247,0,0.0034247,0.0068493,0.0034247,0.0068493,0.0034247,0,0.0034247,0.0034247,0,0,0,0.0034247,0.0034247,0,0,0,0.0034247,0.0068493,0.0034247,0,0.0068493,0,0.0034247,0,0,0,0.0034247,0.0034247,0.0068493,0.0034247,0.0034247,0,0,0,0.0034247,0.0068493,0.0034247,0.0034247,0.0034247,0,0,0,0.0034247,0.0034247,0.0034247,0.0034247,0.0068493,0.0068493,0.0068493,0.0034247,0,0.0068493,0,0,0,0.0034247,0,0.0068493,0,0,0,0.010274,0,0.0034247,0,0,0,0.0034247,0.0068493,0,0,0,0,0,0,0,0,0.0034247,0.0034247,0.0068493,0.0034247,0.0068493,0.0034247,0.0034247,0.0034247,0,0,0.0034247,0.0034247,0.0068493,0.0034247,0,0,0.0034247,0,0,0.0034247,0.0034247,0,0.013699,0.0068493,0,0,0.0068493,0.0068493,0.0034247,0,0,0.0034247,0,0,0.0034247,0.0068493,0.0034247,0.0034247,0.0068493,0,0,0,0.010274,0.0034247,0.0034247,0,0,0,0.0068493,0.0034247,0.0034247,0.0068493,0.0034247,0.0068493,0.0034247,0,0,0.0034247,0.0034247,0,0,0.0034247,0.0034247,0.0034247,0,0.0068493,0,0.0034247,0,0.0034247,0,0.0068493,0.0034247,0,0.0034247,0,0.0034247,0,0.0068493,0.0034247,0,0,0,0.0034247,0,0,0,0,0.0034247,0,0,0,0.0034247,0.0034247,0,0.0034247,0.0034247,0,0,0.0034247,0,0,0.0034247,0,0,0.0068493,0,0.0034247,0.0034247,0,0,0,0.0034247,0,0,0,0,0,0.0034247,0,0,0.0034247,0.0034247,0,0.0068493,0,0,0,0,0,0,0,0,0,0.0034247,0,0,0,0.0034247,0,0.0034247,0,0.0034247,0.0034247,0,0,0,0.0034247,0.0034247,0,0,0.0034247,0,0,0.0034247,0,0,0,0,0,0.0034247,0,0.0034247,0.0034247,0.0034247,0,0,0,0.0034247,0,0.0034247,0.0034247,0,0,0,0.0034247,0.0034247,0,0,0.0034247,0,0.0034247,0,0.0034247,0,0.0034247,0,0,0,0.0034247,0.0034247,0.0034247,0,0.0068493,0,0.0034247,0,0.0034247,0.0034247,0,0,0,0,0,0,0,0.0034247,0.0034247,0.0034247,0,0,0,0,0.0034247,0.0034247,0,0,0.0034247,0,0,0,0,0.0034247,0,0,0,0,0.0034247,0,0.0034247,0,0,0,0,0.0034247,0,0,0.0034247,0,0.0034247,0.0068493,0,0.0034247,0.0034247,0.0034247,0,0,0.0068493,0.0034247,0.0034247,0,0,0,0.0034247,0,0,0,0.0034247,0,0,0,0,0.0034247,0,0,0,0.0034247,0,0.0034247,0,0,0.0034247,0,0.0034247,0,0.0034247,0,0.0034247,0,0.0034247,0,0,0,0,0,0.0034247,0,0,0.0034247,0,0,0,0.0034247,0,0.010274,0.0068493,0.0034247,0,0.0034247,0,0,0.0068493,0,0,0.0034247,0.010274,0,0,0.0034247,0,0,0.0034247,0,0,0.010274,0,0,0.0034247,0,0,0,0,0,0,0,0.0034247,0,0.0034247,0.0034247,0,0.0068493,0.0034247,0.0034247,0.0068493,0,0.0034247,0.0034247,0.0034247,0,0,0.0068493,0.0034247,0,0.0034247,0.0034247,0,0.0034247,0.0034247,0.0034247,0,0,0.0034247,0,0,0.0034247,0.0068493,0,0.0034247,0,0,0,0,0.0034247,0.0068493,0,0,0.0034247,0,0,0.0034247,0,0,0,0,0,0.0034247,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0034247,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0034247,')
xc = stringListToNp(
'67535.3828,67891.7601,68248.1374,68604.5147,68960.892,69317.2693,69673.6465,70030.0238,70386.4011,70742.7784,71099.1557,71455.533,71811.9102,72168.2875,72524.6648,72881.0421,73237.4194,73593.7967,73950.174,74306.5512,74662.9285,75019.3058,75375.6831,75732.0604,76088.4377,76444.8149,76801.1922,77157.5695,77513.9468,77870.3241,78226.7014,78583.0786,78939.4559,79295.8332,79652.2105,80008.5878,80364.9651,80721.3423,81077.7196,81434.0969,81790.4742,82146.8515,82503.2288,82859.6061,83215.9833,83572.3606,83928.7379,84285.1152,84641.4925,84997.8698,85354.247,85710.6243,86067.0016,86423.3789,86779.7562,87136.1335,87492.5107,87848.888,88205.2653,88561.6426,88918.0199,89274.3972,89630.7744,89987.1517,90343.529,90699.9063,91056.2836,91412.6609,91769.0381,92125.4154,92481.7927,92838.17,93194.5473,93550.9246,93907.3019,94263.6791,94620.0564,94976.4337,95332.811,95689.1883,96045.5656,96401.9428,96758.3201,97114.6974,97471.0747,97827.452,98183.8293,98540.2065,98896.5838,99252.9611,99609.3384,99965.7157,100322.093,100678.4702,101034.8475,101391.2248,101747.6021,102103.9794,102460.3567,102816.7339,103173.1112,103529.4885,103885.8658,104242.2431,104598.6204,104954.9977,105311.3749,105667.7522,106024.1295,106380.5068,106736.8841,107093.2614,107449.6386,107806.0159,108162.3932,108518.7705,108875.1478,109231.5251,109587.9023,109944.2796,110300.6569,110657.0342,111013.4115,111369.7888,111726.166,112082.5433,112438.9206,112795.2979,113151.6752,113508.0525,113864.4298,114220.807,114577.1843,114933.5616,115289.9389,115646.3162,116002.6935,116359.0707,116715.448,117071.8253,117428.2026,117784.5799,118140.9572,118497.3344,118853.7117,119210.089,119566.4663,119922.8436,120279.2209,120635.5981,120991.9754,121348.3527,121704.73,122061.1073,122417.4846,122773.8618,123130.2391,123486.6164,123842.9937,124199.371,124555.7483,124912.1256,125268.5028,125624.8801,125981.2574,126337.6347,126694.012,127050.3893,127406.7665,127763.1438,128119.5211,128475.8984,128832.2757,129188.653,129545.0302,129901.4075,130257.7848,130614.1621,130970.5394,131326.9167,131683.2939,132039.6712,132396.0485,132752.4258,133108.8031,133465.1804,133821.5576,134177.9349,134534.3122,134890.6895,135247.0668,135603.4441,135959.8214,136316.1986,136672.5759,137028.9532,137385.3305,137741.7078,138098.0851,138454.4623,138810.8396,139167.2169,139523.5942,139879.9715,140236.3488,140592.726,140949.1033,141305.4806,141661.8579,142018.2352,142374.6125,142730.9897,143087.367,143443.7443,143800.1216,144156.4989,144512.8762,144869.2534,145225.6307,145582.008,145938.3853,146294.7626,146651.1399,147007.5172,147363.8944,147720.2717,148076.649,148433.0263,148789.4036,149145.7809,149502.1581,149858.5354,150214.9127,150571.29,150927.6673,151284.0446,151640.4218,151996.7991,152353.1764,152709.5537,153065.931,153422.3083,153778.6855,154135.0628,154491.4401,154847.8174,155204.1947,155560.572,155916.9493,156273.3265,156629.7038,156986.0811,157342.4584,157698.8357,158055.213,158411.5902,158767.9675,159124.3448,159480.7221,159837.0994,160193.4767,160549.8539,160906.2312,161262.6085,161618.9858,161975.3631,162331.7404,162688.1176,163044.4949,163400.8722,163757.2495,164113.6268,164470.0041,164826.3813,165182.7586,165539.1359,165895.5132,166251.8905,166608.2678,166964.6451,167321.0223,167677.3996,168033.7769,168390.1542,168746.5315,169102.9088,169459.286,169815.6633,170172.0406,170528.4179,170884.7952,171241.1725,171597.5497,171953.927,172310.3043,172666.6816,173023.0589,173379.4362,173735.8134,174092.1907,174448.568,174804.9453,175161.3226,175517.6999,175874.0771,176230.4544,176586.8317,176943.209,177299.5863,177655.9636,178012.3409,178368.7181,178725.0954,179081.4727,179437.85,179794.2273,180150.6046,180506.9818,180863.3591,181219.7364,181576.1137,181932.491,182288.8683,182645.2455,183001.6228,183358.0001,183714.3774,184070.7547,184427.132,184783.5092,185139.8865,185496.2638,185852.6411,186209.0184,186565.3957,186921.773,187278.1502,187634.5275,187990.9048,188347.2821,188703.6594,189060.0367,189416.4139,189772.7912,190129.1685,190485.5458,190841.9231,191198.3004,191554.6776,191911.0549,192267.4322,192623.8095,192980.1868,193336.5641,193692.9413,194049.3186,194405.6959,194762.0732,195118.4505,195474.8278,195831.205,196187.5823,196543.9596,196900.3369,197256.7142,197613.0915,197969.4688,198325.846,198682.2233,199038.6006,199394.9779,199751.3552,200107.7325,200464.1097,200820.487,201176.8643,201533.2416,201889.6189,202245.9962,202602.3734,202958.7507,203315.128,203671.5053,204027.8826,204384.2599,204740.6371,205097.0144,205453.3917,205809.769,206166.1463,206522.5236,206878.9008,207235.2781,207591.6554,207948.0327,208304.41,208660.7873,209017.1646,209373.5418,209729.9191,210086.2964,210442.6737,210799.051,211155.4283,211511.8055,211868.1828,212224.5601,212580.9374,212937.3147,213293.692,213650.0692,214006.4465,214362.8238,214719.2011,215075.5784,215431.9557,215788.3329,216144.7102,216501.0875,216857.4648,217213.8421,217570.2194,217926.5967,218282.9739,218639.3512,218995.7285,219352.1058,219708.4831,220064.8604,220421.2376,220777.6149,221133.9922,221490.3695,221846.7468,222203.1241,222559.5013,222915.8786,223272.2559,223628.6332,223985.0105,224341.3878,224697.765,225054.1423,225410.5196,225766.8969,226123.2742,226479.6515,226836.0287,227192.406,227548.7833,227905.1606,228261.5379,228617.9152,228974.2925,229330.6697,229687.047,230043.4243,230399.8016,230756.1789,231112.5562,231468.9334,231825.3107,232181.688,232538.0653,232894.4426,233250.8199,233607.1971,233963.5744,234319.9517,234676.329,235032.7063,235389.0836,235745.4608,236101.8381,236458.2154,236814.5927,237170.97,237527.3473,237883.7245,238240.1018,238596.4791,238952.8564,239309.2337,239665.611,240021.9883,240378.3655,240734.7428,241091.1201,241447.4974,241803.8747,242160.252,242516.6292,242873.0065,243229.3838,243585.7611,243942.1384,244298.5157,244654.8929,245011.2702,245367.6475,245724.0248,246080.4021,246436.7794,246793.1566,247149.5339,247505.9112,247862.2885,248218.6658,248575.0431,248931.4204,249287.7976,249644.1749,250000.5522,250356.9295,250713.3068,251069.6841,251426.0613,251782.4386,252138.8159,252495.1932,252851.5705,253207.9478,253564.325,253920.7023,254277.0796,254633.4569,254989.8342,255346.2115,255702.5887,256058.966,256415.3433,256771.7206,257128.0979,257484.4752,257840.8524,258197.2297,258553.607,258909.9843,259266.3616,259622.7389,259979.1162,260335.4934,260691.8707,261048.248,261404.6253,261761.0026,262117.3799,262473.7571,262830.1344,263186.5117,263542.889,263899.2663,264255.6436,264612.0208,264968.3981,265324.7754,265681.1527,266037.53,266393.9073,266750.2845,267106.6618,267463.0391,267819.4164,268175.7937,268532.171,268888.5482,269244.9255,269601.3028,269957.6801,270314.0574,270670.4347,271026.812,271383.1892,271739.5665,272095.9438,272452.3211,272808.6984,273165.0757,273521.4529,273877.8302,274234.2075,274590.5848,274946.9621,275303.3394,275659.7166,276016.0939,276372.4712,276728.8485,277085.2258,277441.6031,277797.9803,278154.3576,278510.7349,278867.1122,279223.4895,279579.8668,279936.2441,280292.6213,280648.9986,281005.3759,281361.7532,281718.1305,282074.5078,282430.885,282787.2623,283143.6396,283500.0169,283856.3942,284212.7715,284569.1487,284925.526,285281.9033,285638.2806,285994.6579,286351.0352,286707.4124,287063.7897,287420.167,287776.5443,288132.9216,288489.2989,288845.6761,289202.0534,289558.4307,289914.808,290271.1853,290627.5626,290983.9399,291340.3171,291696.6944,292053.0717,292409.449,292765.8263,293122.2036,293478.5808,293834.9581,294191.3354,294547.7127,294904.09,295260.4673,295616.8445,295973.2218,296329.5991,296685.9764,297042.3537,297398.731,297755.1082,298111.4855,298467.8628,298824.2401,299180.6174,299536.9947,299893.3719,300249.7492,300606.1265,300962.5038,301318.8811,301675.2584,302031.6357,302388.0129,302744.3902,303100.7675,303457.1448,303813.5221,304169.8994,304526.2766,304882.6539,305239.0312,305595.4085,305951.7858,306308.1631,306664.5403,307020.9176,307377.2949,307733.6722,308090.0495,308446.4268,308802.804,309159.1813,309515.5586,309871.9359,310228.3132,310584.6905,310941.0678,311297.445,311653.8223,312010.1996,312366.5769,312722.9542,313079.3315,313435.7087,313792.086,314148.4633,314504.8406,314861.2179,315217.5952,315573.9724,315930.3497,316286.727,316643.1043,316999.4816,317355.8589,317712.2361,318068.6134,318424.9907,318781.368,319137.7453,319494.1226,319850.4998,320206.8771,320563.2544,320919.6317,321276.009,321632.3863,321988.7636,322345.1408,322701.5181,323057.8954,323414.2727,323770.65,324127.0273,324483.4045,324839.7818,325196.1591,325552.5364,325908.9137,326265.291,326621.6682,326978.0455,327334.4228,327690.8001,328047.1774,328403.5547,328759.9319,329116.3092,329472.6865,329829.0638,330185.4411,330541.8184,330898.1956,331254.5729,331610.9502,331967.3275,332323.7048,332680.0821,333036.4594,333392.8366,333749.2139,334105.5912,334461.9685,334818.3458,335174.7231,335531.1003,335887.4776,336243.8549,336600.2322,336956.6095,337312.9868,337669.364,338025.7413,338382.1186,338738.4959,339094.8732,339451.2505,339807.6277,340164.005,340520.3823,340876.7596,341233.1369,341589.5142,341945.8915,342302.2687,342658.646,343015.0233,343371.4006,343727.7779,344084.1552,344440.5324,344796.9097,345153.287,345509.6643,345866.0416,346222.4189,346578.7961,346935.1734,347291.5507,347647.928,348004.3053,348360.6826,348717.0598,349073.4371,349429.8144,349786.1917,350142.569,350498.9463,350855.3235,351211.7008,351568.0781,351924.4554,352280.8327,352637.21,352993.5873,353349.9645,353706.3418,354062.7191,354419.0964,354775.4737,355131.851,355488.2282,355844.6055,356200.9828,356557.3601,356913.7374,357270.1147,357626.4919,357982.8692,358339.2465,358695.6238,359052.0011,359408.3784,359764.7556,360121.1329,360477.5102,360833.8875,361190.2648,361546.6421,361903.0193,362259.3966,362615.7739,362972.1512,363328.5285,363684.9058,364041.2831,364397.6603,364754.0376,365110.4149,365466.7922,365823.1695,366179.5468,366535.924,366892.3013,367248.6786,367605.0559,367961.4332,368317.8105,368674.1877,369030.565,369386.9423,369743.3196,370099.6969,370456.0742,370812.4514,371168.8287,371525.206,371881.5833,372237.9606,372594.3379,372950.7152,373307.0924,373663.4697,374019.847,374376.2243,374732.6016,375088.9789,375445.3561,375801.7334,376158.1107,376514.488,376870.8653,377227.2426,377583.6198,377939.9971,378296.3744,378652.7517,379009.129,379365.5063,379721.8835,380078.2608,380434.6381,380791.0154,381147.3927,381503.77,381860.1472,382216.5245,382572.9018,382929.2791,383285.6564,383642.0337,383998.411,384354.7882,384711.1655,385067.5428,385423.9201,385780.2974,386136.6747,386493.0519,386849.4292,387205.8065,387562.1838,387918.5611,388274.9384,388631.3156,388987.6929,389344.0702,389700.4475,390056.8248,390413.2021,390769.5793,391125.9566,391482.3339,391838.7112,392195.0885,392551.4658,392907.843,393264.2203,393620.5976,393976.9749,394333.3522,394689.7295,395046.1068,395402.484,395758.8613,396115.2386,396471.6159,396827.9932,397184.3705,397540.7477,397897.125,398253.5023,398609.8796,398966.2569,399322.6342,399679.0114,400035.3887,400391.766,400748.1433,401104.5206,401460.8979,401817.2751,402173.6524,402530.0297,402886.407,403242.7843,403599.1616,403955.5389,404311.9161,404668.2934,405024.6707,405381.048,405737.4253,406093.8026,406450.1798,406806.5571,407162.9344,407519.3117,407875.689,408232.0663,408588.4435,408944.8208,409301.1981,409657.5754,410013.9527,410370.33,410726.7072,411083.0845,411439.4618,411795.8391,412152.2164,412508.5937,412864.9709,413221.3482,413577.7255,413934.1028,414290.4801,414646.8574,415003.2347,415359.6119,415715.9892,416072.3665,416428.7438,416785.1211,417141.4984,417497.8756,417854.2529,418210.6302,418567.0075,418923.3848,419279.7621,419636.1393,419992.5166,420348.8939,420705.2712,421061.6485,421418.0258,421774.403,422130.7803,422487.1576,422843.5349,423199.9122,423556.2895,')

core_cap=2926
gamma=0.08/(12*core_cap)
revenue = Revenue(gamma=gamma, k=0.7, beta=1.0)
pb = 0.05/(12*core_cap)
pd = 0.07/(12*core_cap)

assert_almost_equals(compute_optimal_cb(pb, pd, fc, xc), 173735.8134)
assert_almost_equals(compute_optimal_cd(pd, revenue, fc, xc), 423556.2895)
